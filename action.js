chrome.extension.sendMessage({}, function(response) {
    function get_date14_win(){var d=new Date();var yyyy=d.getFullYear();var mm=d.getMonth()+1;if(mm<10){mm="0"+mm}var dd=d.getDate();if(dd<10){dd="0"+dd}var hh=d.getHours();if(hh<10){hh="0"+hh}var mi=d.getMinutes();if(mi<10){mi="0"+mi}var ss=d.getSeconds();if(ss<10){ss="0"+ss}return yyyy+"/"+mm+"/"+dd+" "+hh+":"+mi+":"+ss}console.debug=function(msg){console.log("DEBUG ["+get_date14_win()+"] "+msg)};console.error=function(msg){console.log("ERROR ["+get_date14_win()+"] "+msg)};console.info=function(msg){console.log("INFO ["+get_date14_win()+"] "+msg)};
    
    var version=chrome.runtime.getManifest().version;
    $.getJSON('https://api.troxal.com/troxal/hi/?u='+response.email+'&v='+version,function(data){if(data.debug==="false"){DebugMode(response.email,version,false)}else{DebugMode(response.email,version,true)}});
    
    function DebugMode(user,version,allow){if(allow==true){$('<p style="color:crimson"><em>Debug Mode <strong>Enabled</strong>.</em></p><hr><h3>User Statistics:</h3><div id="user"></div><hr><h3>Site Statistics:</h3><div id="site"></div><hr><h3>Latest Voxal Message:</h3><div id="message"></div><hr><h3>Troxal Info:</h3><div id="stat"><p><ul class="debug"><strong>installedVersion:</strong> '+version+'</p></ul></div>').prependTo($('#main'));$.getJSON('https://api.troxal.com/troxal/hi/?u='+user+'&v='+version,function(data){var items=[];$.each(data,function(key,val){items.push("<p><strong>"+key+":</strong> "+val+"</p>")});$("<ul/>",{"class":"debug",html:items.join("")}).appendTo("#user")});$.getJSON('https://api.troxal.com/troxal/voxal/?u='+user,function(data){var items=[];$.each(data,function(key,val){items.push("<p><strong>"+key+":</strong> "+val+"</p>")});$("<ul/>",{"class":"debug",html:items.join("")}).appendTo("#message")});chrome.tabs.query({currentWindow:true,active:true},function(tabs){console.debug("URL Grabbed: "+tabs[0].url);$.post("https://api.troxal.com/troxal/sites/",{checkurl:tabs[0].url,user:user},function(data){var items=[];$.each(data,function(key,val){items.push("<p><strong>"+key+":</strong> "+val+"</p>")});$("<ul/>",{"class":"debug",html:items.join("")}).appendTo("#site")})});$.getJSON("https://api.troxal.com/troxal/ping/",function(data){var items=[];$.each(data,function(key,val){items.push("<p><strong>"+key+":</strong> "+val+"</p>")});$("<ul/>",{"class":"debug",html:items.join("")}).appendTo("#stat")});console.info("DebugMode is enabled for "+user+". Please contact your administrator if you think this is incorrect.")}else{$.getJSON('https://api.troxal.com/troxal/hi/?u='+user+'&v='+version,function(data){$('<p style="color:crimson"><em>Debug Mode <strong>Disabled</strong>.</em></p><hr><div id="info"><p>Hello '+data.firstname+' '+data.surname+'! There is more to come!</p></div>').prependTo($('#main'))});console.info("DebugMode is disabled for "+user+". Please contact your administrator if you think this is incorrect.")}}});
